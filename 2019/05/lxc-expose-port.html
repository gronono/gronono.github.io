<!DOCTYPE html> <html> <head lang="fr"> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Gronono | Exposer un service tournant dans un container LXC </title> <meta name="description" content="Aujourd’hui j’avais besoin de faire des tests de configuration d’un serveur Apache.Au lieu d’installer le serveur sur ma machine, j’ai décidé de le faire tou..."> <link rel="stylesheet" href="/assets/main.css"> <link rel="canonical" href="http://gronono.github.io/2019/05/lxc-expose-port"> <link rel="alternate" type="application/rss+xml" title="Gronono" href="http://gronono.github.io/feed.xml"/> <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/brands.css" integrity="sha384-i2PyM6FMpVnxjRPi0KW/xIS7hkeSznkllv+Hx/MtYDaHA5VcF0yL3KVlvzp8bWjQ" crossorigin="anonymous"> <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/regular.css" integrity="sha384-hCIN6p9+1T+YkCd3wWjB5yufpReULIPQ21XA/ncf3oZ631q2HEhdC7JgKqbk//4+" crossorigin="anonymous"> <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/solid.css" integrity="sha384-ioUrHig76ITq4aEJ67dHzTvqjsAP/7IzgwE7lgJcg2r7BRNGYSK0LwSmROzYtgzs" crossorigin="anonymous"> <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/fontawesome.css" integrity="sha384-sri+NftO+0hcisDKgr287Y/1LVnInHJ1l+XC7+FOabmTTIK0HnE2ID+xxvJ21c5J" crossorigin="anonymous"> </head> <body> <div class="header-placeholder"></div> <header class="header"> <div class="wrapper"> <div id="sidebar-toggle">TOC</div> <a class="site-title" href="/">Gronono</a> <nav class="site-nav"> <a class="page-link" href="/">Articles</a> <a class="page-link" href="/archives">Archives</a> <a class="page-link" href="/about">À propos</a> </nav> </div> </header> <div class="page-content"> <div class="wrapper"> <div class="col-main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Exposer un service tournant dans un container LXC</h1> <div class="post-meta"> <span class="date"><i class="far fa-calendar-alt"></i> 22 mai 2019</span> <span class="tags"><i class="fas fa-tags"></i> <a href="/tags/lxc">lxc</a> </span> </div> </header> <article class="post-content"> <p>Aujourd’hui j’avais besoin de faire des tests de configuration d’un serveur <a href="https://httpd.apache.org/" rel="nofollow noopener">Apache</a>. Au lieu d’installer le serveur sur ma machine, j’ai décidé de le faire tourner dans un container <a href="https://linuxcontainers.org/" rel="nofollow noopener">LXC</a>.</p> <h2 id="création-du-service-apache-dans-un-container-lxc">Création du service Apache dans un container LXC</h2> <p>Sur ma machien hôte je lance la création du container. J’utilise une image <a href="https://www.debian.org/" rel="nofollow noopener">Debian</a> et je l’appelle “apache”</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ lxc launch images:debian/stretch apache
</code></pre></div></div> <p>Puis j’entre dans le container pour y installer apache et je vérifie l’installation :</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>lxc <span class="nb">exec </span>apache bash
root@apache:~# apt <span class="nb">install </span>apache2 curl
<span class="c"># Pour vérifier l'écoute sur le port 80</span>
root@apache:~# netstat <span class="nt">-tnlp</span> | <span class="nb">grep </span>80
<span class="c"># Pour vérifier "l'affichage" de la page</span>
root@apache:~# curl http://localhost
</code></pre></div></div> <h2 id="exposition-du-service-sur-la-machine-hôte">Exposition du service sur la machine hôte</h2> <p>Par défaut, LXC n’expose pas le service Apache. Il reste cloisonner dans le container. Il faut donc créer un système de proxy pour exposer un port du système de l’hôte (ici 8080) vers le port du container (ici le 80). LXC le fait pour nous via la notion de “config device”. On lance donc la commande:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Pour vérifier que le port 8080 est libre</span>
<span class="nv">$ </span>netstat <span class="nt">-tnlp</span> | <span class="nb">grep </span>8080
<span class="c"># Pour créer le proxy nommé 'port80' depuis le port 8080 de la machine hôte vers le port 80 du container nommé 'apache'</span>
<span class="nv">$ </span>lxc config device add apache port80 proxy <span class="nv">listen</span><span class="o">=</span>tcp:0.0.0.0:8080 <span class="nv">connect</span><span class="o">=</span>tcp:localhost:80
<span class="c"># Pour 'visualiser' ce qu'on vient de faire</span>
<span class="nv">$ </span>lxc config device show apache
<span class="c"># Pour vérifier que le port 8080 est bien écouté par LXC</span>
<span class="nv">$ </span><span class="nb">sudo </span>netstat <span class="nt">-tnlp</span> | <span class="nb">grep </span>8080
<span class="c"># Pour vérifier que le proxy fonctionne correctement</span>
<span class="nv">$ </span>curl http://localhost:8080
</code></pre></div></div> <p>Pour supprimer le proxy, il faut lancer la commande suivante:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>lxc config device remove apache port80
<span class="nv">$ </span>lxc config device show apache
</code></pre></div></div> <p>Je vais pouvoir tester ma configuration d’Apache.</p> </article> <div class="post-comments"> <div id="disqus_thread"></div> <script type="text/javascript">var disqus_shortname="gronono";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" rel="nofollow noopener">comments powered by Disqus.</a> </noscript> </div> </div> </div> <div class="col-second"> <div class="col-box col-box-author"> <img class="avatar" src="/assets/profile.jpg" alt="Arnaud Brunet"> <div class="col-box-title name"> <a href="/about">Arnaud Brunet</a> </div> <blockquote> <p><q>La connaissance s'acquiert par l'expérience, tout le reste n'est que de l'information.</q></p> <footer>Albert Einstein</footer> </blockquote> <ul class="contact"> <li> <a title="GitHub" href="https://github.com/gronono" target="_blank"> <i class="fab fa-github"></i> </a> </li> <li> <a title="Stack Overflow" href="https://stackoverflow.com/users/2909535/arnaud" target="_blank"> <i class="fab fa-stack-overflow"></i> </a> </li> <li> <a title="RSS" href="/feed.xml" target="_blank"> <i class="fas fa-rss"></i> </a> </li> </ul> </div> <div class="col-box"> <div class="col-box-title">Articles récents</div> <ul class="post-list"> <li><a class="post-link" href="/2020/08/virtualbox-routeur">Créer une infra virtuelle avec VirtualBox - Partie 1 : le routeur Internet</a></li> <li><a class="post-link" href="/2019/05/docker-proxy-cache">Installer un proxy-cache pour Docker en 2 minutes</a></li> <li><a class="post-link" href="/2019/05/create-jks-from-p7b">Générer un fichier JKS à partir d'une clé privée et d'un fichier P7B</a></li> <li><a class="post-link" href="/2019/05/ohmyzsh_lxc">Auto-complétion de LXC avec Oh-My-Zsh</a></li> <li><a class="post-link" href="/2019/05/apache-loadbalancer">Configurer Apache en mode load balancer</a></li> <li><a class="post-link" href="/2019/05/lxc-expose-port">Exposer un service tournant dans un container LXC</a></li> <li><a class="post-link" href="/2019/05/jekyll">Reprise du blog</a></li> <li><a class="post-link" href="/2016/11/sqlinjection">SQL Injection</a></li> <li><a class="post-link" href="/2016/11/hibernateutils">HibernateUtils</a></li> <li><a class="post-link" href="/2016/05/install-pxe-server">Installer un serveur PXE</a></li> </ul> </div> <div class="col-box"> <div class="col-box-title">Nuage de tags</div> <a href="/tags/java" class="tag tag-3">java</code></a> <a href="/tags/spring" class="tag tag-2">spring</code></a> <a href="/tags/lxc" class="tag tag-2">lxc</code></a> <a href="/tags/linux" class="tag tag-2">linux</code></a> <a href="/tags/virtualbox" class="tag tag-1">virtualbox</code></a> <a href="/tags/tftp" class="tag tag-1">tftp</code></a> <a href="/tags/sql" class="tag tag-1">sql</code></a> <a href="/tags/réseau" class="tag tag-1">réseau</code></a> <a href="/tags/routeur" class="tag tag-1">routeur</code></a> <a href="/tags/pxe" class="tag tag-1">pxe</code></a> <a href="/tags/oh-my-zsh" class="tag tag-1">oh-my-zsh</code></a> <a href="/tags/loadbalancer" class="tag tag-1">loadbalancer</code></a> <a href="/tags/jekyll" class="tag tag-1">jekyll</code></a> <a href="/tags/hibernate" class="tag tag-1">hibernate</code></a> <a href="/tags/docker" class="tag tag-1">docker</code></a> <a href="/tags/dhcp" class="tag tag-1">dhcp</code></a> <a href="/tags/debian" class="tag tag-1">debian</code></a> <a href="/tags/architecture" class="tag tag-1">architecture</code></a> <a href="/tags/apache" class="tag tag-1">apache</code></a> </div> <div class="col-box post-toc hide"> <div class="col-box-title">Sommaire</div> </div> </div> </div> </div> <footer class="footer"> <div class="wrapper"> <a href="/about">&copy; 2020 Arnaud Brunet</a> </div> </footer> <script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script> <script src="/assets/easybook.js"></script> </body> </html>